<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Boost Reader üß†</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            color: white;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin-bottom: 10px;
        }

        .brain-emoji {
            font-size: 3em;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        /* API Key Section */
        .api-key-section {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 20px;
            margin: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .api-key-section h3 {
            color: #2d3436;
            margin-bottom: 10px;
        }

        .api-key-section p {
            color: #636e72;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .api-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .api-input-group input {
            flex: 1;
            min-width: 250px;
            padding: 12px 15px;
            border: 2px solid #fdcb6e;
            border-radius: 10px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1em;
        }

        .api-input-group input:focus {
            outline: none;
            border-color: #f39c12;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #55efc4 0%, #00b894 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            font-weight: 500;
            font-size: 1.1em;
            z-index: 10000;
            animation: slideIn 0.3s ease-out, slideOut 0.3s ease-in 2.7s;
            opacity: 0;
        }

        .toast.show {
            opacity: 1;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            background: #f0f4ff;
            padding: 10px;
            gap: 8px;
            justify-content: center;
        }

        .nav-tab {
            background: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Fredoka', sans-serif;
            font-weight: 500;
            font-size: 0.95em;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .nav-tab:hover {
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            transform: scale(1.05);
        }

        .content {
            padding: 30px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .welcome-box {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .welcome-box h2 {
            color: #2d3436;
            margin-bottom: 15px;
        }

        .welcome-box p {
            color: #636e72;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            color: white;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
        }

        .stat-card .label {
            font-size: 0.9em;
            margin-top: 5px;
        }

        .lesson-card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #0984e3;
        }

        .lesson-card h3 {
            color: #0984e3;
            margin-bottom: 10px;
        }

        .example-box {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            border: 2px dashed #74b9ff;
        }

        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            margin: 10px 5px;
        }

        .button:hover {
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.3);
        }

        .button:active {
            transform: scale(0.98);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .button.secondary {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
        }

        .quiz-question {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .word-option {
            display: inline-block;
            background: #dfe6e9;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
        }

        .word-option:hover {
            background: #b2bec3;
            transform: scale(1.05);
        }

        .word-option.selected {
            background: #74b9ff;
            color: white;
        }

        .word-option.correct {
            background: #55efc4;
            color: white;
        }

        .word-option.incorrect {
            background: #ff7675;
            color: white;
        }

        .label-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .label-btn {
            background: white;
            border: 2px solid #0984e3;
            color: #0984e3;
            padding: 10px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-family: 'Fredoka', sans-serif;
            font-weight: 500;
            transition: all 0.3s;
        }

        .label-btn:hover {
            background: #0984e3;
            color: white;
            transform: scale(1.05);
        }

        .label-btn.active {
            background: #0984e3;
            color: white;
        }

        .passage-box {
            background: white;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e1e8ed;
            margin-bottom: 20px;
            line-height: 1.8;
            font-size: 1.05em;
            max-height: 500px;
            overflow-y: auto;
        }

        .question-card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
        }

        .answer-option {
            background: white;
            padding: 12px 20px;
            margin: 8px 0;
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid #dfe6e9;
            transition: all 0.3s;
        }

        .answer-option:hover {
            border-color: #0984e3;
            transform: translateX(5px);
        }

        .answer-option.selected {
            background: #74b9ff;
            color: white;
            border-color: #0984e3;
        }

        .answer-option.correct {
            background: #55efc4;
            color: white;
            border-color: #00b894;
        }

        .answer-option.incorrect {
            background: #ff7675;
            color: white;
            border-color: #d63031;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #dfe6e9;
            font-family: 'Fredoka', sans-serif;
            font-size: 1em;
            resize: vertical;
            margin: 15px 0;
        }

        textarea:focus {
            outline: none;
            border-color: #0984e3;
        }

        .star-display {
            font-size: 2em;
            color: #ffd700;
            text-align: center;
            margin: 20px 0;
        }

        .progress-bar {
            background: #dfe6e9;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            height: 100%;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .level-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 15px 30px;
            border-radius: 20px;
            font-size: 1.3em;
            font-weight: bold;
            color: #2d3436;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            margin: 20px 0;
        }

        .benefit-card {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .benefit-card h3 {
            margin-bottom: 15px;
        }

        .result-box {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: center;
        }

        .result-box.success {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .result-box.partial {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            color: #2d3436;
        }

        /* AI Feedback Box */
        .ai-feedback-box {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            line-height: 1.8;
            white-space: pre-line;
        }

        .ai-feedback-box h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        /* Loading Spinner */
        .loading-spinner {
            text-align: center;
            padding: 30px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0984e3;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .info-badge {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 0.95em;
            display: inline-block;
        }

        /* Calendar Styles */
        .calendar-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-header h3 {
            color: #0984e3;
        }

        .edit-mode-toggle {
            background: #ff7675;
            color: white;
            padding: 8px 16px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-family: 'Fredoka', sans-serif;
            transition: all 0.3s;
        }

        .edit-mode-toggle:hover {
            transform: scale(1.05);
        }

        .edit-mode-toggle.active {
            background: #00b894;
        }

        .month-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .month-card {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 15px;
            border: 2px solid #dfe6e9;
        }

        .month-name {
            text-align: center;
            font-weight: bold;
            color: #0984e3;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .day-label {
            text-align: center;
            font-size: 0.8em;
            color: #636e72;
            font-weight: bold;
            padding: 5px;
        }

        .day-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: white;
            border: 2px solid #dfe6e9;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .day-cell:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .day-cell.empty {
            background: transparent;
            border: none;
            cursor: default;
        }

        .day-cell.completed {
            background: #55efc4;
            color: white;
            border-color: #00b894;
            font-weight: bold;
        }

        .day-cell.today {
            border-color: #0984e3;
            border-width: 3px;
            font-weight: bold;
        }

        .day-cell.future {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .streak-display {
            text-align: center;
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .nav-tab {
                font-size: 0.85em;
                padding: 10px 15px;
            }
            
            .content {
                padding: 20px;
            }

            .month-grid {
                grid-template-columns: 1fr;
            }

            .api-input-group {
                flex-direction: column;
            }

            .api-input-group input {
                width: 100%;
            }
        }

        .hide {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <div class="container">
        <div class="header">
            <div class="brain-emoji">üß†</div>
            <h1>Brain Boost Reader</h1>
            <p style="color: white; font-size: 1.1em;">Challenge Your Mind & Boost Your Brainpower!</p>
        </div>

        <!-- API Key Setup Section -->
        <div class="api-key-section">
            <h3>üîë OpenAI API Key Setup</h3>
            <p>Enter your OpenAI API key to unlock AI-generated passages and intelligent summary analysis. Your key is stored locally and never shared.</p>
            <div class="api-input-group">
                <input type="password" id="api-key-input" placeholder="sk-...your-api-key-here..." value="">
                <button class="button" onclick="saveApiKey()">üíæ Save API Key</button>
                <button class="button secondary" onclick="testApiKey()">üß™ Test Connection</button>
            </div>
            <p style="margin-top: 10px; font-size: 0.85em;" id="api-status">Status: Not configured</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('home')">üè† Home</button>
            <button class="nav-tab" onclick="showSection('calendar')">üìÖ Calendar</button>
            <button class="nav-tab" onclick="showSection('grammar')">üìö Grammar</button>
            <button class="nav-tab" onclick="showSection('quiz')">üéØ POS Quiz</button>
            <button class="nav-tab" onclick="showSection('reading')">üìñ Reading</button>
            <button class="nav-tab" onclick="showSection('summarize')">‚úçÔ∏è Summarize</button>
            <button class="nav-tab" onclick="showSection('benefits')">üí° Benefits</button>
            <button class="nav-tab" onclick="showSection('progress')">‚≠ê Progress</button>
        </div>

        <div class="content">
            <!-- HOME SECTION -->
            <div id="home" class="section active">
                <div class="welcome-box">
                    <h2>Welcome to Brain Boost Reader!</h2>
                    <p>Your reading comprehension test showed you're at an <strong>advanced college level</strong> (12th grade+), acing hard passages on abstract scientific concepts like neuroplasticity. This app generates unlimited AI-powered content at your tested HARD level to maximize brain growth through challenging reading, active recall, and summarization practice.</p>
                </div>

                <div class="lesson-card" style="border-left-color: #00b894;">
                    <h3>üìä Your Test Results</h3>
                    <p><strong>‚úÖ Hard Passage (Neuroplasticity):</strong> 100% - Perfect comprehension!</p>
                    <p><strong>‚ö†Ô∏è Medium Passage (Bees):</strong> ~50% - Too easy for you</p>
                    <p><strong>‚úÖ Easy Passage:</strong> Perfect - Way below your level</p>
                    <p style="margin-top: 15px;"><strong>üéØ Recommended Level: HARD</strong> (College-level complexity with abstract concepts, advanced vocabulary, and inference required)</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="number" id="stat-stars">0</div>
                        <div class="label">‚≠ê Stars Earned</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="stat-streak">0</div>
                        <div class="label">üî• Day Streak</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="stat-completed">0</div>
                        <div class="label">‚úÖ Days Complete</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="stat-level">Beginner</div>
                        <div class="label">üéñÔ∏è Current Level</div>
                    </div>
                </div>
            </div>

            <!-- CALENDAR SECTION -->
            <div id="calendar" class="section">
                <h2 style="color: #0984e3; margin-bottom: 20px;">üìÖ 2026 Daily Habit Tracker</h2>
                
                <div class="streak-display">
                    üî• Current Streak: <span id="streak-number">0</span> days
                </div>

                <div class="welcome-box">
                    <h3>Daily Goal</h3>
                    <p>Complete <strong>1 Reading Passage</strong> + <strong>1 Summary</strong> each day to turn it green! ‚úÖ</p>
                    <p style="margin-top: 10px;">Today: <span id="today-status">Not started</span></p>
                </div>

                <div class="calendar-header">
                    <h3>üìÜ 2026 Calendar</h3>
                    <button class="edit-mode-toggle" onclick="toggleEditMode()">Edit Mode: OFF</button>
                </div>

                <div id="calendar-months" class="month-grid"></div>
            </div>

            <!-- GRAMMAR LESSONS SECTION -->
            <div id="grammar" class="section">
                <h2 style="color: #0984e3; margin-bottom: 20px;">üìö Grammar Lessons: Parts of Speech</h2>
                
                <div class="lesson-card">
                    <h3>1. Noun üè∑Ô∏è</h3>
                    <p><strong>What is it?</strong> The naming word - a person, place, animal, thing, or idea.</p>
                    <div class="example-box">
                        <strong>Examples:</strong> dog, school, mom, ball, happiness<br>
                        <strong>Sentence:</strong> The <span style="color: #0984e3; font-weight: bold;">dog</span> barked.
                    </div>
                </div>

                <div class="lesson-card">
                    <h3>2. Verb ‚ö°</h3>
                    <p><strong>What is it?</strong> An action or being word - tells you what's happening.</p>
                    <div class="example-box">
                        <strong>Examples:</strong> run, jump, eat, is, barked, had<br>
                        <strong>Sentence:</strong> The dog <span style="color: #d63031; font-weight: bold;">barked</span>.
                    </div>
                </div>

                <div class="lesson-card">
                    <h3>3. Adjective üé®</h3>
                    <p><strong>What is it?</strong> A describing word that tells you more about a noun. Usually comes before the noun or after "is/looks/feels".</p>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #636e72;"><strong>Note:</strong> Words like "the," "a," and "an" are articles (not adjectives). We're only focusing on descriptive adjectives in this quiz!</p>
                    <div class="example-box">
                        <strong>Examples:</strong> big, red, happy, fluffy, mean, yellow<br>
                        <strong>Sentence:</strong> <span style="color: #00b894; font-weight: bold;">Big fluffy</span> dogs barked.
                    </div>
                </div>

                <div class="lesson-card">
                    <h3>4. Adverb üöÄ</h3>
                    <p><strong>What is it?</strong> Describes HOW, WHEN, or WHERE an action happens. Often ends in "-ly".</p>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #636e72;"><strong>Note:</strong> Words like "to," "over," "in" are prepositions (not adverbs). Focus on -ly words and time/place words like "yesterday," "here," "always."</p>
                    <div class="example-box">
                        <strong>Examples:</strong> quickly, slowly, loudly, happily, yesterday, today, here<br>
                        <strong>Sentence:</strong> Dogs ran <span style="color: #6c5ce7; font-weight: bold;">quickly</span>.
                    </div>
                </div>

                <div class="lesson-card" style="background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%); color: white;">
                    <h3 style="color: white;">üéØ Full Example Sentence</h3>
                    <p style="font-size: 1.2em; line-height: 1.8; margin-bottom: 15px;">
                        <span style="background: rgba(255,255,255,0.3); padding: 3px 8px; border-radius: 5px;">Big fluffy</span> 
                        <span style="background: rgba(255,255,255,0.3); padding: 3px 8px; border-radius: 5px;">dogs</span> 
                        <span style="background: rgba(255,255,255,0.3); padding: 3px 8px; border-radius: 5px;">ran</span> 
                        <span style="background: rgba(255,255,255,0.3); padding: 3px 8px; border-radius: 5px;">quickly</span> 
                        <span style="background: rgba(255,255,255,0.3); padding: 3px 8px; border-radius: 5px;">yesterday</span>.
                    </p>
                    <p style="margin-top: 15px;">
                        <strong>Breakdown:</strong> big, fluffy = adjectives ‚Ä¢ dogs = noun ‚Ä¢ ran = verb ‚Ä¢ quickly, yesterday = adverbs
                    </p>
                    <p style="margin-top: 10px; font-size: 0.9em;">
                        <strong>Note:</strong> We skip articles ("the"), prepositions ("to"), and other parts of speech in our quizzes to keep it simple!
                    </p>
                </div>

                <div class="lesson-card" style="background: #fff5e6; border-left-color: #fdcb6e;">
                    <h3 style="color: #e17055;">üë§ Your Example!</h3>
                    <p style="font-size: 1.15em; margin-bottom: 15px;">
                        "The <strong>mean</strong> <strong>person</strong> <strong>yelled</strong> <strong>loudly</strong>. He <strong>had</strong> a <strong>yellow</strong> <strong>hat</strong>."
                    </p>
                    <p><strong>Nouns:</strong> person, hat</p>
                    <p><strong>Adjectives:</strong> mean, yellow</p>
                    <p><strong>Verbs:</strong> yelled, had</p>
                    <p><strong>Adverb:</strong> loudly</p>
                </div>

                <button class="button" onclick="markComplete('grammar'); showSection('quiz');">Got It! ‚Üí Take the Quiz üéØ</button>
            </div>

            <!-- PARTS OF SPEECH QUIZ SECTION -->
            <div id="quiz" class="section">
                <h2 style="color: #0984e3; margin-bottom: 20px;">üéØ Parts-of-Speech Quiz</h2>
                <p style="margin-bottom: 20px;">Click on each word and then select what part of speech it is! Each quiz has <strong>exactly 4 words</strong> - one of each type (noun, verb, adjective, adverb).</p>
                
                <div id="quiz-container"></div>
                
                <div id="quiz-result" class="result-box hide"></div>
                
                <button class="button" onclick="checkQuiz()">Check My Answers</button>
                <button class="button" onclick="generateNewQuiz()">Generate New Quiz (AI)</button>
            </div>

            <!-- READING PRACTICE SECTION -->
            <div id="reading" class="section">
                <h2 style="color: #0984e3; margin-bottom: 20px;">üìñ Hard Reading Practice (College Level)</h2>
                
                <div class="info-badge">
                    üí° All passages are generated at your tested HARD level: advanced vocabulary, complex concepts, inference required
                </div>

                <p style="margin-bottom: 20px;">Generate a new challenging college-level passage on any topic!</p>
                
                <div class="lesson-card">
                    <h3>Choose a topic or let AI surprise you:</h3>
                    <input type="text" id="reading-topic" placeholder="E.g., quantum mechanics, cognitive neuroscience, evolutionary psychology..." style="width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #dfe6e9; font-family: 'Fredoka', sans-serif; margin: 10px 0;">
                    <button class="button" onclick="generateReading()">üé≤ Generate Hard-Level Reading</button>
                </div>
                
                <div id="passage-content" class="hide"></div>
            </div>

            <!-- SUMMARIZING SECTION -->
            <div id="summarize" class="section">
                <h2 style="color: #0984e3; margin-bottom: 20px;">‚úçÔ∏è Summarizing Guide & Practice (College Level)</h2>
                
                <div class="info-badge">
                    üí° Passages are dynamically generated at your tested hard/college level for maximum brain growth!
                </div>

                <!-- Starter Passages Progress Tracker -->
                <div class="lesson-card" style="border-left-color: #00b894;">
                    <h3>üìã Your First 10 Days - Starter Passages</h3>
                    <p>Complete these 10 curated college-level passages before unlocking AI generation. Track which ones you've done!</p>
                    <div id="starter-passages-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;"></div>
                    <div id="completion-message" class="hide" style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #55efc4 0%, #00b894 100%); color: white; border-radius: 15px; text-align: center;">
                        <h3>üéâ Congratulations!</h3>
                        <p style="margin-top: 10px;">You've completed all 10 starter passages! AI generation is now unlocked. You can now generate unlimited passages on any topic!</p>
                    </div>
                </div>

                <div class="lesson-card">
                    <h3>üìã How to Write a Great Summary (5 Steps)</h3>
                    <ol style="line-height: 2; font-size: 1.05em; margin-left: 20px;">
                        <li><strong>Read the passage twice</strong> - First for the big picture, second to note main ideas</li>
                        <li><strong>Find the main idea</strong> - What's the passage really about?</li>
                        <li><strong>Pick 3-5 key points</strong> - The most important supporting details</li>
                        <li><strong>Write 3-6 sentences in YOUR OWN words</strong> - No copying from the text!</li>
                        <li><strong>Structure it right</strong> - Start with main idea, add key points, end with conclusion/importance</li>
                    </ol>
                </div>

                <div id="starter-passage-buttons">
                    <h3 style="margin: 20px 0 10px;">Select a Day to Load Passage:</h3>
                    <div id="day-selector-buttons" style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;"></div>
                </div>

                <button class="button" id="ai-generate-btn" onclick="generateSummaryPassage()" style="display: none;">üé≤ Generate New AI Passage (Unlocked!)</button>

                <h3 style="margin: 30px 0 15px;">Practice Passage:</h3>
                <div id="current-passage-day" class="info-badge hide" style="display: inline-block; margin-bottom: 10px;"></div>
                <div class="passage-box" id="summary-passage">Select a day above to load a starter passage, or use AI generation once unlocked!</div>

                <h3>Your Summary:</h3>
                <textarea id="user-summary" placeholder="Write your 3-6 sentence summary here using YOUR OWN words..."></textarea>

                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="button" onclick="analyzeSummary()">ü§ñ Analyze My Summary (AI)</button>
                    <button class="button secondary" onclick="saveSummary()">üíæ Save My Summary</button>
                </div>

                <div id="ai-summary-feedback" class="hide"></div>
            </div>

            <!-- BRAIN BENEFITS SECTION -->
            <div id="benefits" class="section">
                <h2 style="color: #0984e3; margin-bottom: 20px;">üí° Why This Works: Brain Benefits</h2>
                
                <div class="benefit-card">
                    <h3>üß† Challenging Reading Builds Neuroplasticity</h3>
                    <p>When you read difficult material at your level, your brain creates new neural connections. This is called neuroplasticity - your brain's ability to rewire and grow stronger. Hard reading builds cognitive reserve, which protects your brain as you age!</p>
                </div>

                <div class="benefit-card">
                    <h3>üéØ Active Techniques Are Super Powerful</h3>
                    <p><strong>The Testing Effect:</strong> Answering questions about what you read is MORE powerful for long-term memory than just summarizing. When you actively recall information, you strengthen those memory pathways.</p>
                    <p style="margin-top: 15px;"><strong>Summarizing:</strong> Writing summaries in your own words forces you to process and understand the material deeply, not just recognize it.</p>
                </div>

                <div class="benefit-card">
                    <h3>‚ö° The Combo Is Best!</h3>
                    <p>Hard reading + active recall (questions) + summarizing = Ultimate brain training! This combination:</p>
                    <ul style="margin-top: 10px; margin-left: 20px; line-height: 1.8;">
                        <li>Strengthens memory and focus</li>
                        <li>Improves critical thinking</li>
                        <li>Builds mental endurance</li>
                        <li>Protects against age-related cognitive decline</li>
                        <li>Makes you a better learner in ALL areas</li>
                    </ul>
                </div>

                <div class="welcome-box" style="margin-top: 30px;">
                    <h3>üöÄ Keep Going!</h3>
                    <p>Every challenging passage you read, every question you answer, and every summary you write is making your brain stronger and more resilient. You're investing in your cognitive future!</p>
                </div>
            </div>

            <!-- PROGRESS TRACKER SECTION -->
            <div id="progress" class="section">
                <h2 style="color: #0984e3; margin-bottom: 20px;">‚≠ê Your Progress Tracker</h2>
                
                <div class="level-badge" id="progress-level">Beginner Brain Booster</div>
                
                <div class="star-display" id="progress-stars">‚≠ê 0 stars earned</div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%">0%</div>
                </div>

                <div style="margin: 30px 0;">
                    <h3>üéØ Level Requirements:</h3>
                    <ul style="line-height: 2; font-size: 1.05em; margin-left: 20px;">
                        <li><strong>Beginner:</strong> 0-10 stars</li>
                        <li><strong>Intermediate:</strong> 11-25 stars</li>
                        <li><strong>Advanced Brain Booster:</strong> 26+ stars</li>
                    </ul>
                </div>

                <h3 style="margin-top: 30px;">üìä Your Achievements:</h3>
                <div id="achievements-list" style="margin-top: 15px;"></div>

                <div class="welcome-box" style="margin-top: 30px;">
                    <h3 id="motivational-message">Keep up the great work! Every star represents brain growth! üåü</h3>
                </div>

                <button class="button" onclick="resetProgress()" style="background: linear-gradient(135deg, #ff7675 0%, #d63031 100%);">Reset All Progress</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // GLOBAL VARIABLES & DATA STORAGE
        // ============================================

        let API_KEY = '';
        let editMode = false;
        let currentSummaryPassage = ''; // Store current passage for AI analysis
        let currentPassageIndex = -1; // Track which starter passage is being used

        // Initialize progress from localStorage
        let progress = {
            stars: 0,
            completed: new Set(),
            level: 'Beginner',
            quizScore: 0,
            readingScores: {},
            summariesWritten: 0,
            completedDays: {}, // format: 'YYYY-MM-DD': { reading: bool, summary: bool }
            currentStreak: 0,
            completedStarterPassages: [] // Track which of the 10 starter passages are done
        };

        // ============================================
        // 10 STARTER PASSAGES (College-Level)
        // ============================================

        const starterPassages = [
            {
                day: 1,
                title: "Neuroplasticity in Adulthood",
                text: `Neuroplasticity, the brain's remarkable ability to reorganize itself by forming new neural connections throughout life, challenges the long-held belief that the adult brain is fixed and immutable. This adaptability arises primarily from synaptic plasticity, where synapses‚Äîthe junctions between neurons‚Äîstrengthen or weaken based on activity patterns, as described by Hebb's rule: "neurons that fire together wire together."

In adulthood, neuroplasticity manifests through experiences such as learning a new language or instrument, which can increase gray matter density in relevant brain regions like the hippocampus and prefrontal cortex. Even after injury, such as stroke, the brain can reassign functions from damaged areas to healthy ones, a process known as cortical remapping.

Key mechanisms include neurogenesis in the hippocampus, long-term potentiation (LTP) for memory consolidation, and the role of neurotrophic factors like brain-derived neurotrophic factor (BDNF), which supports neuron survival and growth. Lifestyle factors profoundly influence this: aerobic exercise elevates BDNF levels, while chronic stress elevates cortisol, impairing plasticity.

Cognitive reserve, built through lifelong intellectual engagement, leverages neuroplasticity to buffer against age-related decline or pathology, explaining why highly educated individuals show delayed symptoms in neurodegenerative diseases like Alzheimer's. However, maladaptive plasticity can occur, as in chronic pain syndromes where neural pathways amplify signals inappropriately.

Understanding neuroplasticity has therapeutic implications, from rehabilitation protocols to interventions for mental health disorders. Techniques like cognitive behavioral therapy exploit plasticity to rewire maladaptive thought patterns in depression or anxiety. Emerging research on psychedelics suggests they enhance plasticity by promoting dendritic spine growth, opening avenues for treating refractory conditions.

Ultimately, neuroplasticity underscores human potential for change at any age, emphasizing the importance of challenging cognitive activities to maintain brain health.`
            },
            {
                day: 2,
                title: "Quantum Entanglement",
                text: `Quantum entanglement, often dubbed "spooky action at a distance" by Einstein, is a phenomenon where two or more particles become linked such that the quantum state of one instantly correlates with the state of another, regardless of separation. This defies classical intuition, where information transfer cannot exceed light speed.

Entanglement arises when particles interact or share a quantum state, described by a joint wave function that cannot factor into independent states. Measuring one particle's property‚Äîspin, polarization, or momentum‚Äîcollapses the wave function, instantaneously determining the other's property, even across vast distances.

The EPR paradox (1935) highlighted this apparent non-locality, suggesting quantum mechanics was incomplete. Bell's theorem (1964) provided testable inequalities: if local hidden variables governed reality, correlations would stay below a threshold. Experiments, starting with Aspect's in 1982 and culminating in 2022 Nobel-winning work by Clauser, Zeilinger, and Aspect, violate these inequalities, confirming entanglement's non-local nature without superluminal signaling, preserving relativity.

Applications abound in quantum technologies. Quantum key distribution (QKD) protocols like BB84 use entanglement for secure communication‚Äîeavesdropping disturbs the state, revealing intrusion. Quantum computing exploits entangled qubits for exponential parallelism, solving problems intractable classically, such as factoring large numbers in Shor's algorithm.

Entanglement also probes foundational questions: does it imply many-worlds interpretation, where all outcomes occur in branching universes, or objective collapse theories? Recent loophole-free Bell tests close detection and locality gaps, solidifying quantum mechanics.

In cosmology, entanglement may relate to black hole information paradox, with proposals like ER=EPR conjecturing wormholes link entangled particles. As quantum networks advance, entanglement swapping enables quantum internet, promising revolutionary information processing paradigms while challenging our philosophical understanding of reality.`
            },
            {
                day: 3,
                title: "The Psychology of Habit Formation",
                text: `Habit formation represents a cornerstone of human behavior, enabling efficient action through automated responses that conserve cognitive resources. Charles Duhigg's "habit loop"‚Äîcue, craving, response, reward‚Äîencapsulates this, but neuroscientific models reveal deeper mechanisms involving the basal ganglia and dopaminergic pathways.

Initiation begins with goal-directed behavior in the prefrontal cortex, but repetition shifts control to the striatum, transforming actions into habits via chunking‚Äîsequenced behaviors compressed into single units. Dopamine release reinforces this: initially signaling reward prediction error, it eventually anticipates cues, driving craving.

Context dependency makes habits sticky; environmental triggers (cues) reliably elicit responses, explaining difficulty in breaking habits in familiar settings. Implementation intentions‚Äî"if-then" planning‚Äîexploit this by linking cues to desired behaviors, boosting success rates in interventions.

Keystone habits, like exercise, trigger cascades improving multiple domains through self-efficacy spillover. Conversely, stress hijacks habits via amygdala-prefrontal disconnects, reverting to impulsive actions.

Neuroplasticity underpins change: synaptic strengthening in habit circuits competes with new learning. Techniques like habit reversal training target this, replacing unwanted responses. Recent research on "habit discontinuity hypothesis" suggests life transitions disrupt cues, creating windows for change.

Individual differences arise from genetics (e.g., DRD2 receptor variants affecting dopamine sensitivity) and personality traits like conscientiousness. Technology complicates this‚Äîapps deliver variable rewards mimicking slot machines, fostering addictive loops in social media.

Understanding habits informs public health and productivity. By engineering cues and rewards mindfully, individuals harness this psychological machinery for positive transformation, while recognizing its vulnerability to exploitation in modern environments.`
            },
            {
                day: 4,
                title: "Exoplanets and the Habitable Zone",
                text: `The discovery of exoplanets‚Äîworlds orbiting stars beyond our solar system‚Äîhas revolutionized astrobiology, with over 5,000 confirmed since 1995 via methods like transit photometry and radial velocity. The habitable zone (HZ), or "Goldilocks zone," defines orbital distances where liquid water could exist on a planetary surface, crucial for life as we know it.

HZ boundaries depend on stellar type: hotter stars expand the zone outward, while cooler red dwarfs contract it, potentially tidally locking close planets. However, atmospheric composition complicates this‚Äîgreenhouse gases like CO2 can extend habitability inward (as on Venus) or outward.

Rocky exoplanets in the HZ, like those in TRAPPIST-1 system, intrigue researchers, but challenges include stellar flares from M-dwarfs stripping atmospheres. Kepler and TESS missions identified thousands of candidates, with JWST now spectroscopically analyzing atmospheres for biosignatures‚Äîoxygen, methane imbalances suggesting biological activity.

The Drake equation frames search probability, but Fermi paradox questions absence of evidence. Proposed solutions include rare intelligence emergence or "great filters." Recent focus on ocean worlds‚Äîsubsurface liquid beneath ice, like Europa‚Äîexpands habitability beyond traditional HZ.

Venus-like runaway greenhouse or Mars-like atmospheric loss highlight fragility. Exoplanet diversity‚Äîsuper-Earths, mini-Neptunes‚Äîsuggests Earth's configuration may be atypical. Future missions like ARIEL will characterize atmospheres en masse.

Ultimately, finding life elsewhere would profoundly impact philosophy and science, informing Earth's biosphere uniqueness while guiding SETI efforts.`
            },
            {
                day: 5,
                title: "Epigenetics and Environmental Influence",
                text: `Epigenetics studies heritable changes in gene expression without altering DNA sequence, mediated by mechanisms like DNA methylation, histone modification, and non-coding RNAs. These chemical tags act as molecular switches, silencing or activating genes in response to environment.

Lamarckian ideas revive through epigenetics: experiences influence offspring via gamete modifications. Classic examples include Dutch Hunger Winter studies showing famine exposure leading to metabolic disorders in descendants via persistent methylation patterns.

Developmental plasticity allows organisms to adapt phenotypes to predicted environments‚Äîe.g., nutrient scarcity cueing thriftiness. Transgenerational effects occur in plants and animals, though mammalian germline reprogramming limits persistence.

Stress exemplifies this: chronic cortisol alters glucocorticoid receptor methylation in hippocampus, impairing regulation and increasing anxiety risk, transmitted paternally via sperm RNAs.

Cancer arises from epigenetic dysregulation‚Äîhypermethylation silencing tumor suppressors. Therapies like demethylating agents show promise.

Nutritional epigenetics links diet to marks: folate donates methyl groups, while toxins like BPA disrupt them. Aging accumulates epigenetic drift, contributing to decline.

Evolutionary implications suggest epigenetics accelerates adaptation in changing environments, bridging timescales between genetic mutation and selection.

As CRISPR evolves to target epigenome, ethical concerns mount regarding designer traits and intergenerational impacts.`
            },
            {
                day: 6,
                title: "Cognitive Biases in Decision Making",
                text: `Cognitive biases‚Äîsystematic deviations from rationality‚Äîstem from brain's dual-process thinking: fast, intuitive System 1 versus slow, analytical System 2. Kahneman and Tversky's prospect theory reveals loss aversion: losses loom larger than equivalent gains, explaining risk-seeking in losses.

Confirmation bias drives selective information seeking that reinforces beliefs, fueling polarization. Anchoring effects initial information disproportionately, as in negotiations.

Availability heuristic judges probability by recall ease‚Äîvivid events like shark attacks seem commoner than statistics warrant.

Sunk cost fallacy persists with failing endeavors due to prior investment, ignoring future costs.

In groups, groupthink suppresses dissent for harmony, while overconfidence bias leads to calibration errors in judgments.

Evolutionary psychology posits many biases as adaptations to ancestral environments: better safe than sorry in threat detection.

Debiasing techniques include considering alternatives, pre-mortems, and statistical training, though recalcitrance persists due to metacognitive blindness.

In policy and business, awareness mitigates errors‚Äîe.g., blinded review processes counter halo effects.

Understanding biases fosters humility in reasoning, essential for navigating complex modern decisions.`
            },
            {
                day: 7,
                title: "The Fermi Paradox",
                text: `The Fermi paradox‚Äînamed after physicist Enrico Fermi's question "Where is everybody?"‚Äîhighlights the contradiction between high estimates of extraterrestrial civilizations and lack of evidence. The Drake equation multiplies factors like star formation rate, habitable planets fraction, and intelligence emergence to estimate communicative civilizations.

Recent data refines this: billions of habitable zone exoplanets exist, yet SETI searches yield silence. Proposed resolutions span rare Earth hypothesis (complex life requires improbable conditions) to great filters‚Äîbarriers like abiogenesis or nuclear self-destruction.

Zoo hypothesis suggests advanced civilizations deliberately avoid contact, while simulation argument posits we inhabit an ancestor simulation.

Dark forest theory analogizes cosmos to a forest where hunters shoot first, incentivizing silence.

Temporal explanations note universe youth‚Äîintelligence may arise later‚Äîor civilizations' brevity.

Aestivation hypothesis proposes advanced beings hibernate awaiting cooler future universe for efficient computation.

Resolution may come from better understanding life's origins or detecting technosignatures via upcoming telescopes.

The paradox forces reflection on humanity's future and cosmic place.`
            },
            {
                day: 8,
                title: "Deep Learning Architectures",
                text: `Deep learning, subset of machine learning using multi-layered neural networks, has transformed AI through representation learning from raw data. Convolutional neural networks (CNNs) excel in vision tasks via hierarchical feature extraction‚Äîedges to objects‚Äîusing parameter-sharing convolution.

Recurrent neural networks (RNNs) handle sequences, but vanishing gradients limit long dependencies; LSTMs and GRUs mitigate via gating.

Transformers, introduced in "Attention is All You Need," revolutionize with self-attention mechanisms weighing token importance, enabling parallelization and scaling.

Architectures like BERT use bidirectional context for language understanding, while GPT series autoregressively generate text via massive pretraining.

Vision transformers (ViT) apply attention to image patches, rivaling CNNs.

Generative adversarial networks (GANs) pit generator against discriminator for realistic synthesis.

Diffusion models gradually denoise data for high-quality generation.

Challenges include interpretability‚Äîblack box nature‚Äîand catastrophic forgetting in continual learning.

Efficiency advances like quantization address deployment.

As scaling laws suggest performance improves with parameters/data/compute, frontier models push capabilities toward AGI while raising alignment concerns.`
            },
            {
                day: 9,
                title: "Climate Feedback Loops",
                text: `Climate feedback loops amplify or dampen warming in Earth's complex system. Positive feedbacks accelerate change: ice-albedo effect‚Äîmelting ice reduces reflectivity, absorbing more heat.

Permafrost thaw releases methane, potent greenhouse gas, creating runaway potential.

Water vapor feedback: warmer air holds more vapor, enhancing greenhouse effect.

Cloud feedbacks remain uncertain‚Äîlow clouds cool, high warm.

Amazon dieback could turn carbon sink to source.

Negative feedbacks stabilize: increased photosynthesis initially absorbs CO2, though saturation limits.

Ocean acidification impairs calcifying organisms, disrupting food webs.

Tipping elements like Greenland ice sheet collapse could raise seas irreversibly.

Anthropogenic forcing overwhelms negatives, driving unprecedented change.

Modeling feedbacks critically informs projections; underestimation risks surprises.

Mitigation requires rapid emissions cuts to avoid crossing thresholds.`
            },
            {
                day: 10,
                title: "Memory Consolidation During Sleep",
                text: `Memory consolidation transforms labile traces into stable long-term storage, crucially involving sleep. Systems consolidation transfers hippocampal-dependent episodic memories to neocortical networks for schema integration.

Slow-wave sleep (SWS) features oscillations coordinating replay‚Äîcompressed reactivation of waking neuronal sequences, strengthened via synaptic downscaling in homeostatic regulation.

Spindles during N2 sleep couple with hippocampal ripples for precise transfer.

REM sleep supports emotional memory processing and procedural skill consolidation through theta rhythms and pontine-geniculo-occipital waves.

Sleep deprivation impairs consolidation, increasing forgetting.

Molecular mechanisms include protein synthesis and gene expression triggered by learning.

Dreams may reflect offline processing, aiding creativity via associative recombination.

Individual differences in sleep architecture predict memory performance.

Therapeutic targeting‚Äîe.g., transcranial stimulation enhancing spindles‚Äîshows promise for disorders.

Understanding consolidation illuminates learning optimization and neurological conditions like Alzheimer's disrupting replay.`
            }
        ];

        // ============================================
        // TOAST NOTIFICATION SYSTEM
        // ============================================

        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }

        // ============================================
        // API KEY MANAGEMENT
        // ============================================

        function saveApiKey() {
            const keyInput = document.getElementById('api-key-input');
            const key = keyInput.value.trim();
            
            if (!key) {
                showToast('‚ùå Please enter an API key');
                return;
            }
            
            if (!key.startsWith('sk-')) {
                showToast('‚ùå Invalid API key format (should start with sk-)');
                return;
            }
            
            API_KEY = key;
            localStorage.setItem('openaiApiKey', key);
            document.getElementById('api-status').textContent = 'Status: ‚úÖ API key saved';
            document.getElementById('api-status').style.color = '#00b894';
            
            showToast('‚úÖ API Key Saved Successfully!');
        }

        async function testApiKey() {
            if (!API_KEY) {
                showToast('‚ùå Please save an API key first');
                return;
            }
            
            showToast('üß™ Testing connection...');
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            { role: 'user', content: 'Say "test successful"' }
                        ],
                        max_tokens: 10
                    })
                });
                
                if (response.ok) {
                    showToast('‚úÖ Connection Successful!');
                    document.getElementById('api-status').textContent = 'Status: ‚úÖ Connected and working';
                    document.getElementById('api-status').style.color = '#00b894';
                } else {
                    const error = await response.json();
                    showToast(`‚ùå Error: ${error.error?.message || 'Connection failed'}`);
                    document.getElementById('api-status').textContent = 'Status: ‚ùå Connection failed';
                    document.getElementById('api-status').style.color = '#d63031';
                }
            } catch (error) {
                showToast('‚ùå Network error - check your connection');
                document.getElementById('api-status').textContent = 'Status: ‚ùå Network error';
                document.getElementById('api-status').style.color = '#d63031';
            }
        }

        // ============================================
        // OPENAI API CALL FUNCTION
        // ============================================

        async function callOpenAI(systemPrompt, userPrompt, model = 'gpt-4o-mini') {
            if (!API_KEY) {
                showToast('‚ùå Please set up your OpenAI API key first!');
                return null;
            }

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: userPrompt }
                        ],
                        temperature: 0.7,
                        max_tokens: 2000
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || `API Error: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('OpenAI API Error:', error);
                showToast(`‚ùå API Error: ${error.message}`);
                return null;
            }
        }

        // ============================================
        // SUMMARY PASSAGE GENERATION (NEW AI FEATURE)
        // ============================================

        function renderStarterPassagesTracker() {
            const grid = document.getElementById('starter-passages-grid');
            const completed = progress.completedStarterPassages || [];
            
            grid.innerHTML = starterPassages.map((passage, index) => {
                const isCompleted = completed.includes(index + 1);
                const bgColor = isCompleted ? '#55efc4' : '#dfe6e9';
                const textColor = isCompleted ? 'white' : '#2d3436';
                const icon = isCompleted ? '‚úÖ' : '‚≠ï';
                
                return `
                    <div style="background: ${bgColor}; color: ${textColor}; padding: 15px; border-radius: 10px; text-align: center; font-weight: bold; transition: all 0.3s;">
                        ${icon} Day ${passage.day}
                        <div style="font-size: 0.85em; margin-top: 5px; font-weight: normal;">${passage.title}</div>
                    </div>
                `;
            }).join('');
            
            // Show completion message if all 10 are done
            const allComplete = completed.length >= 10;
            if (allComplete) {
                document.getElementById('completion-message').classList.remove('hide');
                document.getElementById('ai-generate-btn').style.display = 'inline-block';
                document.getElementById('starter-passage-buttons').style.display = 'none';
            } else {
                document.getElementById('completion-message').classList.add('hide');
                document.getElementById('ai-generate-btn').style.display = 'none';
                document.getElementById('starter-passage-buttons').style.display = 'block';
            }
            
            // Render day selector buttons
            renderDaySelectorButtons();
        }

        function renderDaySelectorButtons() {
            const container = document.getElementById('day-selector-buttons');
            const completed = progress.completedStarterPassages || [];
            
            container.innerHTML = starterPassages.map((passage, index) => {
                const isCompleted = completed.includes(index + 1);
                const buttonStyle = isCompleted ? 
                    'background: linear-gradient(135deg, #55efc4 0%, #00b894 100%); color: white;' : 
                    'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;';
                
                return `
                    <button class="button" onclick="loadStarterPassage(${index})" style="${buttonStyle}">
                        ${isCompleted ? '‚úÖ' : 'üìñ'} Day ${passage.day}
                    </button>
                `;
            }).join('');
        }

        function loadStarterPassage(index) {
            const passage = starterPassages[index];
            currentSummaryPassage = passage.text;
            currentPassageIndex = index + 1;
            
            document.getElementById('summary-passage').textContent = passage.text;
            document.getElementById('user-summary').value = '';
            document.getElementById('ai-summary-feedback').classList.add('hide');
            
            // Show which day is currently loaded
            const dayBadge = document.getElementById('current-passage-day');
            dayBadge.textContent = `üìñ Day ${passage.day}: ${passage.title}`;
            dayBadge.classList.remove('hide');
            
            // Store in localStorage
            localStorage.setItem('currentSummaryPassage', currentSummaryPassage);
            localStorage.setItem('currentPassageIndex', currentPassageIndex);
            
            showToast(`üìñ Loaded Day ${passage.day} passage!`);
        }

        async function generateSummaryPassage() {
            // Check if AI generation is unlocked
            const completed = progress.completedStarterPassages || [];
            if (completed.length < 10) {
                showToast('‚ùå Complete all 10 starter passages first to unlock AI generation!');
                return;
            }
            
            const container = document.getElementById('summary-passage');
            const feedbackDiv = document.getElementById('ai-summary-feedback');
            const dayBadge = document.getElementById('current-passage-day');
            
            // Clear previous content
            feedbackDiv.classList.add('hide');
            document.getElementById('user-summary').value = '';
            currentPassageIndex = -1; // Mark as AI-generated
            dayBadge.classList.add('hide');
            
            // Show loading state
            container.innerHTML = '<div class="loading-spinner"><div class="spinner"></div><p>ü§ñ AI is generating a challenging college-level passage...</p></div>';
            
            // Hard-coded prompt for college-level passage generation
            const systemPrompt = "You are an expert educator creating challenging reading material for advanced college-level readers.";
            
            const userPrompt = `Generate a 400-500 word non-fiction reading passage at college-level difficulty (advanced vocabulary, complex sentences, abstract concepts requiring inference).

Topic: Choose an interesting science/psychology/neuroscience topic (vary each time - examples: quantum physics basics, memory formation, evolutionary biology, AI ethics, climate systems, consciousness, biochemistry, astrophysics, behavioral economics, linguistic relativity).

Make it engaging and factual. Include sophisticated vocabulary and concepts that require deep thinking.

Output ONLY the plain text passage, no title, no extra text.`;

            const result = await callOpenAI(systemPrompt, userPrompt, 'gpt-4o-mini');
            
            if (result) {
                currentSummaryPassage = result.trim();
                container.textContent = currentSummaryPassage;
                
                // Store in localStorage as backup
                localStorage.setItem('currentSummaryPassage', currentSummaryPassage);
                localStorage.setItem('currentPassageIndex', '-1');
                
                showToast('‚úÖ New AI passage generated!');
            } else {
                container.textContent = 'Error generating passage. Please check your API key and try again.';
            }
        }

        // ============================================
        // SUMMARY ANALYSIS (NEW AI FEATURE)
        // ============================================

        async function analyzeSummary() {
            const userSummary = document.getElementById('user-summary').value.trim();
            const feedbackDiv = document.getElementById('ai-summary-feedback');
            
            // Validation
            if (!currentSummaryPassage) {
                showToast('‚ùå Please generate a passage first!');
                return;
            }
            
            if (userSummary.length < 50) {
                showToast('‚ùå Your summary is too short! Write 3-6 sentences.');
                return;
            }
            
            // Show loading state
            feedbackDiv.className = 'ai-feedback-box';
            feedbackDiv.innerHTML = '<div class="loading-spinner"><div class="spinner"></div><p>ü§ñ AI Reading Coach is analyzing your summary...</p></div>';
            feedbackDiv.classList.remove('hide');
            
            // Hard-coded system prompt (EXACT as specified in requirements)
            const systemPrompt = `You are an expert reading coach in the "Brain Boost Reader" app. Your job is to analyze a user's summary of a challenging college-level passage and give constructive feedback to improve their comprehension, memory, and cognitive skills.

The ideal summary should:
- Start with the main idea.
- Include 3‚Äì5 key supporting points.
- Be written entirely in the user's own words (no copying phrases from the passage).
- Be accurate (no added or distorted information).
- Be concise (3‚Äì6 sentences).
- Have clear structure and flow.

Provide feedback in this exact format:
1. Overall Score: X/10 (brief reason).
2. Strengths: 2‚Äì3 specific positives (quote examples).
3. Areas to Improve: 2‚Äì3 specific suggestions (quote examples, explain why it matters for understanding).
4. Revised Tip: One short example sentence showing how to fix one issue (without rewriting the whole summary).
5. Encouragement: Motivational close about brain benefits (mention neuroplasticity or cognitive reserve).

Tone: Friendly, encouraging, precise. Always start and end positive. Keep total response under 300 words.

Original Passage:
${currentSummaryPassage}

User's Summary:
${userSummary}

Now analyze and respond.`;

            const userPrompt = "Please analyze the summary above according to the criteria provided.";
            
            const result = await callOpenAI(systemPrompt, userPrompt, 'gpt-4o-mini');
            
            if (result) {
                feedbackDiv.className = 'ai-feedback-box';
                feedbackDiv.innerHTML = `<h3>ü§ñ AI Reading Coach Feedback</h3><div style="white-space: pre-line;">${result}</div>`;
                showToast('‚úÖ Analysis complete!');
            } else {
                feedbackDiv.innerHTML = '<p style="color: #ff7675;">Error analyzing summary. Please check your API key and network connection.</p>';
            }
        }

        // ============================================
        // PROGRESS MANAGEMENT
        // ============================================

        function loadProgress() {
            const saved = localStorage.getItem('brainBoostProgress');
            if (saved) {
                const parsed = JSON.parse(saved);
                progress = {
                    ...parsed,
                    completed: new Set(parsed.completed || []),
                    completedDays: parsed.completedDays || {}
                };
            }
            
            // Load API key
            const savedKey = localStorage.getItem('openaiApiKey');
            if (savedKey) {
                API_KEY = savedKey;
                document.getElementById('api-key-input').value = savedKey;
                document.getElementById('api-status').textContent = 'Status: ‚úÖ API key loaded';
                document.getElementById('api-status').style.color = '#00b894';
            }
            
            // Load current summary passage if exists
            const savedPassage = localStorage.getItem('currentSummaryPassage');
            if (savedPassage) {
                currentSummaryPassage = savedPassage;
            }
            
            updateProgressDisplay();
            calculateStreak();
        }

        function saveProgress() {
            const toSave = {
                ...progress,
                completed: Array.from(progress.completed)
            };
            localStorage.setItem('brainBoostProgress', JSON.stringify(toSave));
            updateProgressDisplay();
            calculateStreak();
        }

        function updateProgressDisplay() {
            document.getElementById('stat-stars').textContent = progress.stars;
            document.getElementById('stat-completed').textContent = Object.keys(progress.completedDays).filter(day => {
                const data = progress.completedDays[day];
                return data.reading && data.summary;
            }).length;
            document.getElementById('stat-level').textContent = progress.level;
            document.getElementById('stat-streak').textContent = progress.currentStreak;
            
            // Update progress page
            document.getElementById('progress-stars').textContent = `‚≠ê ${progress.stars} stars earned`;
            
            // Calculate level
            if (progress.stars >= 26) {
                progress.level = 'Advanced Brain Booster';
            } else if (progress.stars >= 11) {
                progress.level = 'Intermediate';
            } else {
                progress.level = 'Beginner';
            }
            
            document.getElementById('progress-level').textContent = progress.level;
            document.getElementById('stat-level').textContent = progress.level;
            
            // Update progress bar (max 50 stars for 100%)
            const percentage = Math.min((progress.stars / 50) * 100, 100);
            const progressFill = document.getElementById('progress-fill');
            progressFill.style.width = percentage + '%';
            progressFill.textContent = Math.round(percentage) + '%';
            
            // Update achievements
            updateAchievements();
            
            // Update motivational message
            updateMotivationalMessage();
            
            // Update today's status
            updateTodayStatus();
        }

        function updateTodayStatus() {
            const today = getTodayString();
            const todayData = progress.completedDays[today] || { reading: false, summary: false };
            
            let status = '';
            if (todayData.reading && todayData.summary) {
                status = '‚úÖ Complete! Great job!';
            } else if (todayData.reading) {
                status = 'üìñ Reading done, need summary';
            } else if (todayData.summary) {
                status = '‚úçÔ∏è Summary done, need reading';
            } else {
                status = '‚ùå Not started';
            }
            
            const statusEl = document.getElementById('today-status');
            if (statusEl) statusEl.textContent = status;
        }

        function updateAchievements() {
            const list = document.getElementById('achievements-list');
            const achievements = [];
            
            if (progress.completed.has('grammar')) achievements.push('‚úÖ Completed Grammar Lessons');
            if (progress.quizScore >= 8) achievements.push('üéØ Aced the POS Quiz (8+ correct)');
            if (Object.keys(progress.readingScores).length >= 3) achievements.push('üìñ Read 3+ passages');
            if (progress.summariesWritten >= 1) achievements.push('‚úçÔ∏è Wrote a summary');
            if (progress.stars >= 10) achievements.push('‚≠ê Earned 10 stars');
            if (progress.stars >= 25) achievements.push('üåü Earned 25 stars');
            if (progress.currentStreak >= 3) achievements.push('üî• 3-day streak!');
            if (progress.currentStreak >= 7) achievements.push('üî•üî• 7-day streak!');
            if (progress.currentStreak >= 30) achievements.push('üî•üî•üî• 30-day streak!!!');
            
            list.innerHTML = achievements.length > 0 
                ? achievements.map(a => `<div class="lesson-card">${a}</div>`).join('')
                : '<div class="lesson-card">Start completing sections to earn achievements!</div>';
        }

        function updateMotivationalMessage() {
            const messages = {
                'Beginner': 'Keep up the great work! Every star represents brain growth! üåü',
                'Intermediate': 'You\'re doing amazing! Your brain is getting stronger every day! üí™',
                'Advanced Brain Booster': 'Wow! You\'re a cognitive champion! Keep pushing your limits! üèÜ'
            };
            document.getElementById('motivational-message').textContent = messages[progress.level];
        }

        function awardStars(num) {
            progress.stars += num;
            saveProgress();
            showToast(`üéâ You earned ${num} star${num > 1 ? 's' : ''}!`);
        }

        function markComplete(section) {
            if (!progress.completed.has(section)) {
                progress.completed.add(section);
                awardStars(2);
            }
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset all your progress? This cannot be undone!')) {
                localStorage.removeItem('brainBoostProgress');
                progress = {
                    stars: 0,
                    completed: new Set(),
                    level: 'Beginner',
                    quizScore: 0,
                    readingScores: {},
                    summariesWritten: 0,
                    completedDays: {},
                    currentStreak: 0
                };
                updateProgressDisplay();
                renderCalendar();
                showToast('Progress reset! Start your journey again! üöÄ');
            }
        }

        function saveSummary() {
            const userText = document.getElementById('user-summary').value.trim();
            
            if (userText.length < 50) {
                showToast('‚ùå Your summary is too short! Write 3-6 sentences.');
                return;
            }
            
            // Mark starter passage as complete if applicable
            if (currentPassageIndex > 0 && currentPassageIndex <= 10) {
                if (!progress.completedStarterPassages) {
                    progress.completedStarterPassages = [];
                }
                if (!progress.completedStarterPassages.includes(currentPassageIndex)) {
                    progress.completedStarterPassages.push(currentPassageIndex);
                    showToast(`‚úÖ Day ${currentPassageIndex} completed! Summary saved!`);
                    
                    // Check if all 10 are done
                    if (progress.completedStarterPassages.length === 10) {
                        showToast('üéâ All 10 starter passages complete! AI generation unlocked!');
                    }
                } else {
                    showToast('‚úÖ Summary saved!');
                }
                
                // Update the tracker display
                renderStarterPassagesTracker();
            } else {
                showToast('‚úÖ Summary saved! Great work!');
            }
            
            progress.summariesWritten++;
            awardStars(2);
            markComplete('summarize');
            
            // Mark summary as done for today
            const today = getTodayString();
            if (!progress.completedDays[today]) {
                progress.completedDays[today] = { reading: false, summary: false };
            }
            progress.completedDays[today].summary = true;
            saveProgress();
            renderCalendar();
        }

        // ============================================
        // CALENDAR FUNCTIONS
        // ============================================

        function getTodayString() {
            const now = new Date();
            return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
        }

        function calculateStreak() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            let streak = 0;
            let checkDate = new Date(today);
            
            while (true) {
                const dateStr = `${checkDate.getFullYear()}-${String(checkDate.getMonth() + 1).padStart(2, '0')}-${String(checkDate.getDate()).padStart(2, '0')}`;
                const dayData = progress.completedDays[dateStr];
                
                if (dayData && dayData.reading && dayData.summary) {
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }
            
            progress.currentStreak = streak;
            document.getElementById('streak-number').textContent = streak;
        }

        function toggleEditMode() {
            editMode = !editMode;
            const btn = document.querySelector('.edit-mode-toggle');
            if (editMode) {
                btn.textContent = 'Edit Mode: ON';
                btn.classList.add('active');
                showToast('üìù Edit mode enabled - click days to toggle completion');
            } else {
                btn.textContent = 'Edit Mode: OFF';
                btn.classList.remove('active');
                showToast('üëÅÔ∏è Edit mode disabled');
            }
        }

        function markDayComplete(dateStr) {
            const today = getTodayString();
            const clickedDate = new Date(dateStr);
            const todayDate = new Date(today);
            
            // In edit mode, allow marking any past day
            if (editMode) {
                if (clickedDate > todayDate) {
                    showToast('‚ùå Cannot mark future days!');
                    return;
                }
                
                if (!progress.completedDays[dateStr]) {
                    progress.completedDays[dateStr] = { reading: false, summary: false };
                }
                
                // Toggle completion
                const dayData = progress.completedDays[dateStr];
                if (dayData.reading && dayData.summary) {
                    // Already complete, unmark it
                    dayData.reading = false;
                    dayData.summary = false;
                    showToast('‚ùå Day unmarked');
                } else {
                    // Mark as complete
                    dayData.reading = true;
                    dayData.summary = true;
                    showToast('‚úÖ Day marked complete');
                }
                
                saveProgress();
                renderCalendar();
            }
        }

        function renderCalendar() {
            const container = document.getElementById('calendar-months');
            const months = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            
            const today = getTodayString();
            const todayDate = new Date(today);
            
            let html = '';
            
            for (let month = 0; month < 12; month++) {
                const firstDay = new Date(2026, month, 1);
                const lastDay = new Date(2026, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startDayOfWeek = firstDay.getDay();
                
                html += `
                    <div class="month-card">
                        <div class="month-name">${months[month]} 2026</div>
                        <div class="calendar-grid">
                            <div class="day-label">Sun</div>
                            <div class="day-label">Mon</div>
                            <div class="day-label">Tue</div>
                            <div class="day-label">Wed</div>
                            <div class="day-label">Thu</div>
                            <div class="day-label">Fri</div>
                            <div class="day-label">Sat</div>
                `;
                
                // Empty cells before first day
                for (let i = 0; i < startDayOfWeek; i++) {
                    html += '<div class="day-cell empty"></div>';
                }
                
                // Days of month
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `2026-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const dayData = progress.completedDays[dateStr] || { reading: false, summary: false };
                    const isComplete = dayData.reading && dayData.summary;
                    const isToday = dateStr === today;
                    const cellDate = new Date(2026, month, day);
                    const isFuture = cellDate > todayDate;
                    
                    let classes = 'day-cell';
                    if (isComplete) classes += ' completed';
                    if (isToday) classes += ' today';
                    if (isFuture) classes += ' future';
                    
                    html += `<div class="${classes}" onclick="markDayComplete('${dateStr}')">${day}</div>`;
                }
                
                html += '</div></div>';
            }
            
            container.innerHTML = html;
        }

        // ============================================
        // NAVIGATION
        // ============================================

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            
            // Remove active from all tabs
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Highlight active tab
            event.target.classList.add('active');
            
            // Load section-specific content
            if (sectionId === 'calendar') renderCalendar();
            if (sectionId === 'quiz') initQuiz();
            if (sectionId === 'summarize') renderStarterPassagesTracker();
        }

        // ============================================
        // QUIZ GENERATION (AI-POWERED)
        // ============================================

        let currentQuizData = null;
        let currentQuizAnswers = {};
        let selectedWord = null;

        async function generateNewQuiz() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = '<div class="loading-spinner"><div class="spinner"></div><p>ü§ñ Generating new quiz questions...</p></div>';
            
            const systemPrompt = "You are a grammar expert. Return ONLY valid JSON with no markdown formatting, no code blocks, no explanation.";
            
            const userPrompt = `Generate 1 sentence for a parts-of-speech quiz. The sentence must contain EXACTLY 4 words:
- EXACTLY 1 noun
- EXACTLY 1 verb  
- EXACTLY 1 adjective
- EXACTLY 1 adverb

Do NOT include articles (the, a, an), prepositions (in, on, at, to, from), pronouns (I, you, he, she, it), conjunctions (and, but, or), or any other parts of speech.

Return ONLY valid JSON in this exact format with no additional text or markdown:
[
  {
    "sentence": "Happy students learn quickly",
    "words": [
      {"word": "Happy", "pos": "adjective"},
      {"word": "students", "pos": "noun"},
      {"word": "learn", "pos": "verb"},
      {"word": "quickly", "pos": "adverb"}
    ]
  }
]

Make the sentence interesting and use adult-level vocabulary. The sentence must have EXACTLY 4 words total.`;

            const result = await callOpenAI(systemPrompt, userPrompt, 'gpt-4o-mini');
            
            if (result) {
                try {
                    // Clean up the result in case it has markdown
                    let cleanResult = result.trim();
                    if (cleanResult.startsWith('```json')) {
                        cleanResult = cleanResult.replace(/```json\n?/g, '').replace(/```\n?/g, '');
                    } else if (cleanResult.startsWith('```')) {
                        cleanResult = cleanResult.replace(/```\n?/g, '');
                    }
                    
                    currentQuizData = JSON.parse(cleanResult);
                    
                    // Validate that we have exactly 4 words
                    if (currentQuizData[0].words.length !== 4) {
                        throw new Error('Generated sentence does not have exactly 4 words');
                    }
                    
                    displayQuiz();
                    showToast('‚úÖ New quiz generated!');
                } catch (error) {
                    console.error('Error parsing quiz data:', error);
                    showToast('‚ùå Error generating quiz. Please try again.');
                    container.innerHTML = '<p>Error generating quiz. Please try again.</p>';
                }
            }
        }

        function initQuiz() {
            // Initialize with a default quiz if no AI quiz loaded
            // Each sentence has EXACTLY 4 words: 1 noun, 1 verb, 1 adjective, 1 adverb
            if (!currentQuizData) {
                currentQuizData = [
                    {
                        sentence: "Happy students learn quickly",
                        words: [
                            { word: "Happy", pos: "adjective" },
                            { word: "students", pos: "noun" },
                            { word: "learn", pos: "verb" },
                            { word: "quickly", pos: "adverb" }
                        ]
                    }
                ];
            }
            displayQuiz();
        }

        function displayQuiz() {
            currentQuizAnswers = {};
            const container = document.getElementById('quiz-container');
            
            container.innerHTML = currentQuizData.map((q, qIndex) => `
                <div class="quiz-question">
                    <h3>Identify Each Word:</h3>
                    <p style="font-size: 1.3em; margin: 20px 0; font-weight: bold; text-align: center;">${q.sentence}</p>
                    <p style="margin-bottom: 15px; color: #636e72;">Click each word, then click its part of speech. This quiz has exactly 4 words - find 1 noun, 1 verb, 1 adjective, and 1 adverb!</p>
                    <div style="text-align: center; margin: 20px 0;">
                        ${q.words.map((w, wIndex) => `
                            <span class="word-option" 
                                  data-question="${qIndex}" 
                                  data-word="${wIndex}"
                                  onclick="selectWord(${qIndex}, ${wIndex})"
                                  style="font-size: 1.1em; padding: 10px 20px; margin: 8px;">
                                ${w.word}
                            </span>
                        `).join('')}
                    </div>
                    <div class="label-buttons" style="justify-content: center;">
                        <button class="label-btn" onclick="assignLabel(${qIndex}, 'noun')">üè∑Ô∏è Noun</button>
                        <button class="label-btn" onclick="assignLabel(${qIndex}, 'verb')">‚ö° Verb</button>
                        <button class="label-btn" onclick="assignLabel(${qIndex}, 'adjective')">üé® Adjective</button>
                        <button class="label-btn" onclick="assignLabel(${qIndex}, 'adverb')">üöÄ Adverb</button>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('quiz-result').classList.add('hide');
        }

        function selectWord(qIndex, wIndex) {
            document.querySelectorAll('.word-option').forEach(w => w.classList.remove('selected'));
            const wordEl = document.querySelector(`[data-question="${qIndex}"][data-word="${wIndex}"]`);
            wordEl.classList.add('selected');
            selectedWord = { qIndex, wIndex };
        }

        function assignLabel(qIndex, label) {
            if (!selectedWord || selectedWord.qIndex !== qIndex) {
                showToast('‚ùå Please select a word first!');
                return;
            }
            
            const key = `${qIndex}-${selectedWord.wIndex}`;
            currentQuizAnswers[key] = label;
            
            const wordEl = document.querySelector(`[data-question="${qIndex}"][data-word="${selectedWord.wIndex}"]`);
            wordEl.style.background = '#74b9ff';
            wordEl.style.color = 'white';
            wordEl.textContent = `${currentQuizData[qIndex].words[selectedWord.wIndex].word} (${label})`;
            
            selectedWord = null;
        }

        function checkQuiz() {
            if (!currentQuizData) return;
            
            let correct = 0;
            let total = 0;
            
            currentQuizData.forEach((q, qIndex) => {
                q.words.forEach((w, wIndex) => {
                    total++;
                    const key = `${qIndex}-${wIndex}`;
                    const userAnswer = currentQuizAnswers[key];
                    const wordEl = document.querySelector(`[data-question="${qIndex}"][data-word="${wIndex}"]`);
                    
                    if (userAnswer === w.pos) {
                        correct++;
                        wordEl.classList.add('correct');
                        wordEl.classList.remove('incorrect');
                    } else {
                        wordEl.classList.add('incorrect');
                        wordEl.classList.remove('correct');
                    }
                });
            });
            
            const percentage = Math.round((correct / total) * 100);
            const resultBox = document.getElementById('quiz-result');
            resultBox.classList.remove('hide');
            
            if (correct === total) {
                // Perfect score - all 4 correct!
                resultBox.className = 'result-box success';
                resultBox.innerHTML = `<h2>üéâ Perfect Score!</h2><p>You got all ${total} correct (100%)! Excellent work!</p>`;
                awardStars(3);
                markComplete('quiz');
            } else if (correct >= 3) {
                // 3 out of 4 correct
                resultBox.className = 'result-box partial';
                resultBox.innerHTML = `<h2>Good Job!</h2><p>You got ${correct} out of ${total} correct (${percentage}%). Almost there - review and try again!</p>`;
                awardStars(1);
            } else {
                // Less than 3 correct
                resultBox.className = 'result-box';
                resultBox.innerHTML = `<h2>Keep Practicing!</h2><p>You got ${correct} out of ${total} correct (${percentage}%). Review the grammar lessons and try again!</p>`;
            }
            
            progress.quizScore = correct;
            saveProgress();
        }

        // ============================================
        // READING GENERATION (AI-POWERED)
        // ============================================

        let currentReadingData = null;
        let readingAnswers = {};

        async function generateReading() {
            const topic = document.getElementById('reading-topic').value.trim() || 'any advanced scientific or psychological topic';
            const content = document.getElementById('passage-content');
            
            content.innerHTML = '<div class="loading-spinner"><div class="spinner"></div><p>ü§ñ Generating challenging college-level passage...</p></div>';
            content.classList.remove('hide');
            
            const systemPrompt = "You are an expert educator creating challenging college-level content. Return ONLY valid JSON with no markdown, no code blocks, no explanation.";
            
            const userPrompt = `Create a challenging, hard-level reading passage (400-600 words) about ${topic}. The passage should be at advanced college-level: complex concepts, require inference, sophisticated vocabulary, abstract ideas suitable for someone who aced neuroplasticity passages.

Then create 5 multiple-choice comprehension questions with 4 options each. Questions should test deep understanding and inference, not just recall.

Return ONLY valid JSON in this exact format with no additional text:
{
  "title": "Passage Title",
  "text": "The full passage text...",
  "questions": [
    {
      "question": "Question text?",
      "options": ["Option A", "Option B", "Option C", "Option D"],
      "correct": 0
    }
  ]
}`;

            const result = await callOpenAI(systemPrompt, userPrompt, 'gpt-4o-mini');
            
            if (result) {
                try {
                    let cleanResult = result.trim();
                    if (cleanResult.startsWith('```json')) {
                        cleanResult = cleanResult.replace(/```json\n?/g, '').replace(/```\n?/g, '');
                    } else if (cleanResult.startsWith('```')) {
                        cleanResult = cleanResult.replace(/```\n?/g, '');
                    }
                    
                    currentReadingData = JSON.parse(cleanResult);
                    displayReading();
                    showToast('‚úÖ New passage generated!');
                } catch (error) {
                    console.error('Error parsing reading data:', error);
                    showToast('‚ùå Error generating passage. Please try again.');
                    content.innerHTML = '<p>Error generating passage. Please try again.</p>';
                }
            }
        }

        function displayReading() {
            readingAnswers = {};
            const content = document.getElementById('passage-content');
            
            content.innerHTML = `
                <h3 style="color: #0984e3; margin-bottom: 20px;">${currentReadingData.title}</h3>
                <div class="passage-box">${currentReadingData.text}</div>
                
                <h3 style="margin: 30px 0 15px;">üìù Comprehension Questions</h3>
                <div id="questions-container">
                    ${currentReadingData.questions.map((q, qIndex) => `
                        <div class="question-card">
                            <p style="font-weight: bold; margin-bottom: 15px;">${qIndex + 1}. ${q.question}</p>
                            ${q.options.map((opt, optIndex) => `
                                <div class="answer-option" 
                                     data-question="${qIndex}" 
                                     data-option="${optIndex}"
                                     onclick="selectReadingAnswer(${qIndex}, ${optIndex})">
                                    ${opt}
                                </div>
                            `).join('')}
                        </div>
                    `).join('')}
                </div>
                
                <button class="button" onclick="checkReadingAnswers()">Check My Answers</button>
                <div id="reading-result"></div>
            `;
        }

        function selectReadingAnswer(questionIndex, optionIndex) {
            const key = questionIndex;
            readingAnswers[key] = optionIndex;
            
            document.querySelectorAll(`[data-question="${questionIndex}"]`).forEach(el => {
                el.classList.remove('selected');
            });
            
            const selectedEl = document.querySelector(`[data-question="${questionIndex}"][data-option="${optionIndex}"]`);
            selectedEl.classList.add('selected');
        }

        function checkReadingAnswers() {
            if (!currentReadingData) return;
            
            let correct = 0;
            
            currentReadingData.questions.forEach((q, qIndex) => {
                const userAnswer = readingAnswers[qIndex];
                const correctAnswer = q.correct;
                
                const options = document.querySelectorAll(`[data-question="${qIndex}"]`);
                options.forEach((opt, optIndex) => {
                    opt.classList.remove('selected');
                    if (optIndex === correctAnswer) {
                        opt.classList.add('correct');
                    } else if (optIndex === userAnswer && userAnswer !== correctAnswer) {
                        opt.classList.add('incorrect');
                    }
                });
                
                if (userAnswer === correctAnswer) correct++;
            });
            
            const total = currentReadingData.questions.length;
            const percentage = Math.round((correct / total) * 100);
            const resultDiv = document.getElementById('reading-result');
            
            if (correct > 0) {
                resultDiv.className = 'result-box success';
                resultDiv.innerHTML = `<h2>üéâ Great Job!</h2><p>You got ${correct} out of ${total} correct (${percentage}%)!</p>`;
                awardStars(2);
                
                // Mark reading as done for today
                const today = getTodayString();
                if (!progress.completedDays[today]) {
                    progress.completedDays[today] = { reading: false, summary: false };
                }
                progress.completedDays[today].reading = true;
                saveProgress();
                renderCalendar();
            } else {
                resultDiv.className = 'result-box partial';
                resultDiv.innerHTML = `<h2>Keep Trying!</h2><p>You got ${correct} out of ${total} correct. Read more carefully!</p>`;
            }
            
            readingAnswers = {};
        }

        // ============================================
        // INITIALIZE ON LOAD
        // ============================================

        window.onload = function() {
            loadProgress();
            renderCalendar();
            initQuiz();
            renderStarterPassagesTracker();
            
            // Load saved passage if exists
            const savedIndex = localStorage.getItem('currentPassageIndex');
            if (savedIndex && savedIndex !== '-1' && parseInt(savedIndex) > 0) {
                const index = parseInt(savedIndex) - 1;
                if (index >= 0 && index < starterPassages.length) {
                    loadStarterPassage(index);
                }
            }
        };
    </script>
</body>
</html>